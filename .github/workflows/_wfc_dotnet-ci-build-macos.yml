name: dotnet-build-macos

on:
  workflow_call:
    inputs:
      solutionName:
        required: true
        type: string
    secrets:
      CODECOV_TOKEN:
        required: false

jobs:
  build:
    runs-on: macos-latest
    env:
      DOTNET_CLI_TELEMETRY_OPTOUT: 1
      DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
      DOTNET_NOLOGO: true
      DOTNET_GENERATE_ASPNET_CERTIFICATE: false
      solutionpath: ${{ inputs.solutionName }}.sln
      unittestprojectpath: ${{ inputs.solutionName }}.UnitTests/${{ inputs.solutionName }}.UnitTests.csproj
      inttestprojectpath: ${{ inputs.solutionName }}.IntegrationTests/${{ inputs.solutionName }}.IntegrationTests.csproj
      benchmarkprojectpath: ${{ inputs.solutionName }}.Benchmarks/${{ inputs.solutionName }}.Benchmarks.csproj
    steps:
      # Two-checkout pattern: checkout triggering repo and this repo for action access
      - name: Checkout repository being built
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
        with:
          path: a
          fetch-depth: 0

      - name: Checkout github-action-workflows (actions & scripts)
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
        with:
          repository: dpvreony/github-action-workflows
          path: github-action-workflows
          fetch-depth: 0

      - name: Run Common Build Steps
        uses: ./github-action-workflows/.github/actions/dotnet-build-common
        with:
          solutionName: ${{ inputs.solutionName }}
          isPrimaryBuildOs: false
          osName: macos
          codecovToken: ${{ secrets.CODECOV_TOKEN }}
